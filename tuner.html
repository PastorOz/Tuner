<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="UTF-8"&gt;</p>
<p class="p1">&lt;title&gt;Middle C Pitch Tuner&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>body {</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-family: Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: #f0f4f8;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>h1 {</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: #333;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#tuner {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 300px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 150px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 40px auto;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: 2px solid #ddd;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#tuner:before {</p>
<p class="p1"><span class="Apple-converted-space">    </span>content: '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">    </span>top: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>left: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 2px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 70%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: #ccc;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform: translate(-50%, -50%);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#needle {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">    </span>bottom: 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>left: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 2px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>height: 70%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: red;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform-origin: bottom center;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform: translateX(-50%) rotate(0deg);</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition: transform 0.1s ease-out, background-color 0.1s ease-out;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>#frequency {</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 1.5em;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: 20px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls {</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin-top: 30px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 10px 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin: 0 10px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 1em;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: #007bff;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.btn:disabled {</p>
<p class="p1"><span class="Apple-converted-space">    </span>background-color: #aaa;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;h1&gt;Middle C Pitch Tuner&lt;/h1&gt;</p>
<p class="p1">&lt;div id="tuner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="needle"&gt;&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p1">&lt;div id="frequency"&gt;Frequency: -- Hz&lt;/div&gt;</p>
<p class="p1">&lt;div class="controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button id="play-note" class="btn"&gt;Play Middle C&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;button id="start-listening" class="btn"&gt;Start Listening&lt;/button&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">const middleCFrequency = 261.63;</p>
<p class="p1">let audioContext;</p>
<p class="p1">let analyserNode;</p>
<p class="p1">let microphoneStream;</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('play-note').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const context = new (window.AudioContext || window.webkitAudioContext)();</p>
<p class="p1"><span class="Apple-converted-space">  </span>const oscillator = context.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">  </span>oscillator.type = 'sine';</p>
<p class="p1"><span class="Apple-converted-space">  </span>oscillator.frequency.setValueAtTime(middleCFrequency, context.currentTime);</p>
<p class="p1"><span class="Apple-converted-space">  </span>oscillator.connect(context.destination);</p>
<p class="p1"><span class="Apple-converted-space">  </span>oscillator.start();</p>
<p class="p1"><span class="Apple-converted-space">  </span>oscillator.stop(context.currentTime + 2); // Play for 2 seconds</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">document.getElementById('start-listening').addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (audioContext) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>audioContext = new (window.AudioContext || window.webkitAudioContext)();</p>
<p class="p1"><span class="Apple-converted-space">  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const stream = await navigator.mediaDevices.getUserMedia({ audio: true });</p>
<p class="p1"><span class="Apple-converted-space">    </span>microphoneStream = audioContext.createMediaStreamSource(stream);</p>
<p class="p1"><span class="Apple-converted-space">    </span>analyserNode = audioContext.createAnalyser();</p>
<p class="p1"><span class="Apple-converted-space">    </span>analyserNode.fftSize = 2048;</p>
<p class="p1"><span class="Apple-converted-space">    </span>microphoneStream.connect(analyserNode);</p>
<p class="p1"><span class="Apple-converted-space">    </span>detectPitch();</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.getElementById('start-listening').disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">  </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>console.error('Error accessing microphone:', err);</p>
<p class="p1"><span class="Apple-converted-space">    </span>alert('Microphone access is required for this feature.');</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">function detectPitch() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const bufferLength = analyserNode.fftSize;</p>
<p class="p1"><span class="Apple-converted-space">  </span>const dataArray = new Float32Array(bufferLength);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const updatePitch = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>analyserNode.getFloatTimeDomainData(dataArray);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const pitch = autoCorrelate(dataArray, audioContext.sampleRate);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (pitch !== -1) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateNeedle(pitch);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(updatePitch);</p>
<p class="p1"><span class="Apple-converted-space">  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>updatePitch();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function updateNeedle(frequency) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const needle = document.getElementById('needle');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const freqDisplay = document.getElementById('frequency');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const centsOff = 1200 * Math.log2(frequency / middleCFrequency);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const maxCents = 50; // Maximum cents deviation displayed</p>
<p class="p1"><span class="Apple-converted-space">  </span>let angle = (centsOff / maxCents) * 45; // Max angle is ±45 degrees</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Clamp angle</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (angle &gt; 45) angle = 45;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (angle &lt; -45) angle = -45;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Change needle color based on accuracy</p>
<p class="p1"><span class="Apple-converted-space">  </span>const absCentsOff = Math.abs(centsOff);</p>
<p class="p1"><span class="Apple-converted-space">  </span>let color = 'red';</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (absCentsOff &lt;= 5) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>color = 'green';</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else if (absCentsOff &lt;= 15) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>color = 'orange';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>needle.style.transform = `translateX(-50%) rotate(${angle}deg)`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>needle.style.backgroundColor = color;</p>
<p class="p1"><span class="Apple-converted-space">  </span>freqDisplay.innerText = `Frequency: ${frequency.toFixed(2)} Hz`;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Auto-correlation algorithm to detect pitch</p>
<p class="p1">function autoCorrelate(buffer, sampleRate) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Perform auto-correlation</p>
<p class="p1"><span class="Apple-converted-space">  </span>let SIZE = buffer.length;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let rms = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; SIZE; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>rms += buffer[i] * buffer[i];</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>rms = Math.sqrt(rms / SIZE);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (rms &lt; 0.01) return -1; // Too quiet</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let r1 = 0, r2 = SIZE - 1, thres = 0.2;</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; SIZE / 2; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (Math.abs(buffer[i]) &lt; thres) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>r1 = i;</p>
<p class="p1"><span class="Apple-converted-space">      </span>break;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 1; i &lt; SIZE / 2; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (Math.abs(buffer[SIZE - i]) &lt; thres) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>r2 = SIZE - i;</p>
<p class="p1"><span class="Apple-converted-space">      </span>break;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>buffer = buffer.slice(r1, r2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>SIZE = buffer.length;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const c = new Array(SIZE).fill(0);</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = 0; i &lt; SIZE; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let j = 0; j &lt; SIZE - i; j++) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>c[i] = c[i] + buffer[j] * buffer[j + i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let d = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>while (c[d] &gt; c[d + 1]) d++;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let maxval = -1, maxpos = -1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>for (let i = d; i &lt; SIZE; i++) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (c[i] &gt; maxval) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>maxval = c[i];</p>
<p class="p1"><span class="Apple-converted-space">      </span>maxpos = i;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>let T0 = maxpos;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return sampleRate / T0;</p>
<p class="p1">}</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
